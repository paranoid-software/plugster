class e extends Object{constructor(t,i){super();if(!e.document)e.document=$(document);if(!e.registry){e.registry={};$("[data-controller-name]").map((function(t,i){e.registry[$(i).data("controllerName").toLowerCase()]=undefined}))}if(!e.explicitSubscriptions)e.explicitSubscriptions={};if(!e.htmlDeclaredSubscriptions)e.htmlDeclaredSubscriptions={};this.locales={};this.name=i||this.constructor.name;this._=t;this.childTemplates={};console.log(`${this.name} Controller Instantiated.`);this.init()}static plug(t){e.registry[t.name.toLowerCase()]=t;let i=true;Object.keys(e.registry).map((function(t){if(!e.registry[t])i=false}));if(!i)return;if(window.plugsters)return;Object.keys(e.registry).map((function(t){let i=e.registry[t];let n=e.registry[t]._.root;Object.keys(n.data()).map((function(t){let r=t.replace(/[A-Z]/g,(e=>"-"+e.toLowerCase()));let s=r.split("-");if(s.length!==3)return null;if(s[0]!=="on")return null;let l=n.data(t);if(!i[l])throw new Error(`There is no method ${l} within the ${i.name} controller !!!`);let o=s[1];let a=s[2];if(!e.registry[o])throw new Error(`There is no ${o} controller !!!`);let c=Object.getOwnPropertyNames(Object.getPrototypeOf(e.registry[o])).map((e=>e.toLowerCase()));if(c.indexOf(a)<0)throw new Error(`There is no ${a} event in ${o} controller !!!`);e.htmlDeclaredSubscriptions[`${o}_${a}_${i.name.toLowerCase()}`]={listener:i,methodName:l}}))}));window.plugsters=e.registry}setLocales(e){this.locales=e}translateTo(e,t){if(!this.locales[e])return t;if(!this.locales[e][t])return t;return this.locales[e][t]}toString(){return this.name}init(){let e=this;console.log(`Initializing ${e.name} Controller.`);e.bindOutlets((function(){console.log(`${e.name} Controller Initialized`);e.afterInit()}))}afterInit(){throw new Error("You have to implement the Plugster afterInit method !!!")}bindOutlets(e){let t=this;console.log(`Binding Outlets for ${t.name} Controller.`);let i=[];let n=`[data-controller-name=${t.name}]`;if($(n).length===0)throw new Error(`There is no view with a ${t.name} controller !!!`);let r=$(n);$.map(t._,(function(e,n){let s=`[data-outlet-id='${n}']`;if(r.find(s).length===0)throw new Error(`Outlet ${n} does not exist, check both ${t.name} view and controller !!!`);let l=r.find(s);if(l.length>1){let e=$.map(l,(function(e){if($(e).closest("[data-controller-name]").data("controller-name")===t.name)return $(e);return null}));l=e[0]}l.attr("id",`${t.name}_${n}`);if(l.data("child-templates")){l.buildListItem=function(e,i,r,s,l){if(!this.items)this.items={};if(!this.items[i])this.items[i]={};this.append(t.childTemplates[`${n}_${e}`]);let o=t.compileChildTemplate(n,this.children().length-1,this.children().last(),s);if(o===null)return null;o.root.attr("data-key",i);if(l)o.root.click((function(){l(i,r)}));this.items[i].outlets=o;this.items[i].data=r;return this.items[i].outlets};l.count=function(){if(!this.items)return 0;return Object.keys(this.items).length};l.getData=function(e){return this.items[e].data};l.getOutlets=function(e){return this.items[e].outlets};l.delete=function(e){this.children(`[data-key='${e}']`).remove();delete this.items[e]};l.clear=function(){this.items=undefined;this.children().remove()};let e=l.data("child-templates");$.map(e,(function(e,r){let s=$.Deferred();i.push(s.promise());t.loadChildTemplate(n,r,e,s)}))}t._[n]=l}));t._.root=r;console.log(`Outlets for ${t.name} Controller were binded successfuly !!!`);window.Promise.all(i).then((function(){e()}))}loadChildTemplate(e,t,i,n){let r=this;$.get({url:i,cache:false},(function(s){r.childTemplates[`${e}_${t}`]=s;console.log(`Template ${i} loaded.`);n.resolve()}))}compileChildTemplate(e,t,i,n){if(!n||Object.keys(n).length===0)return null;let r={};r.root=i;$.map(i.find("[data-child-outlet-id]"),(function(i){$(i).attr("id",`${e}_${$(i).data("child-outlet-id")}_${t}`);r[$(i).data("child-outlet-id")]=$(i)}));return r}registerEventSignature(e,t,i){if(!e)return;if(!t)return;if(!i)return;let n=this.cloneDeep(t);$(this).on(e,n,i)}dispatchEvent(e,t){let i=this.cloneDeep(t);this.broadcastExplicitSubscriptionsMessages(e,i);this.broadcastHtmlDeclaredSubscriptionsMessages(e,i);$(this).triggerHandler(new $.Event(e,{args:i}))}cloneDeep(e,t=new WeakMap){let i=this;const n=["Array","Object","Map","Set","WeakMap","WeakSet"];const r=Object.prototype.toString.call(e);if(!new RegExp(n.join("|")).test(r))return e;if(t.has(e)){return t.get(e)}const s=new e.constructor;if(e instanceof Map||e instanceof WeakMap){e.forEach(((e,t)=>s.set(i.cloneDeep(t),i.cloneDeep(e))))}if(e instanceof Set||e instanceof WeakSet){e.forEach((e=>s.add(i.cloneDeep(e))))}t.set(e,s);return Object.assign(s,...Object.keys(e).map((n=>({[n]:i.cloneDeep(e[n],t)}))))}broadcastExplicitSubscriptionsMessages(t,i){let n=this;let r=`${this.name}_${t}`.toLowerCase();Object.keys(e.explicitSubscriptions).map((function(s){if(s.startsWith(r)){e.explicitSubscriptions[s]?.onNewMessage(n.name,t,i)}}))}broadcastHtmlDeclaredSubscriptionsMessages(t,i){let n=`${this.name}_${t}`.toLowerCase();Object.keys(e.htmlDeclaredSubscriptions).map((function(t){if(t.startsWith(n)){let n=e.htmlDeclaredSubscriptions[t];n.listener[n.methodName].call(n.listener,i)}}))}listenTo(t,i){e.explicitSubscriptions[`${t.name}_${i.name}_${this.name}`.toLowerCase()]=this}static createView(e,t,i){$.get({url:t,cache:false},(function(t){i(t.replace("[CONTROLLER_NAME]",e))}))}}export{e as Plugster};
//# sourceMappingURL=plugster.min.js.map