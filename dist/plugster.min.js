class e extends Object{constructor(t,i){super(),e.document||(e.document=$(document)),e.registry||(e.registry={},$("[data-controller-name]").map((function(t,i){e.registry[$(i).data("controllerName").toLowerCase()]=void 0}))),e.explicitSubscriptions||(e.explicitSubscriptions={}),e.htmlDeclaredSubscriptions||(e.htmlDeclaredSubscriptions={}),this.locales={},this.name=i||this.constructor.name,this._=t,this.childTemplates={},console.log(`${this.name} Controller Instantiated.`)}static plug(t){e.registry[t.name.toLowerCase()]=t;let i=!0;Object.keys(e.registry).map((function(t){e.registry[t]||(i=!1)})),i&&(window.plugsters||(Object.keys(e.registry).map((function(t){let i=e.registry[t],n=e.registry[t]._.root;Object.keys(n.data()).map((function(t){let r=t.replace(/[A-Z]/g,(e=>"-"+e.toLowerCase())).split("-");if(3!==r.length)return null;if("on"!==r[0])return null;let s=n.data(t);if(!i[s])throw new Error(`There is no method ${s} within the ${i.name} controller !!!`);let o=r[1],l=r[2];if(!e.registry[o])throw new Error(`There is no ${o} controller !!!`);if(Object.getOwnPropertyNames(Object.getPrototypeOf(e.registry[o])).map((e=>e.toLowerCase())).indexOf(l)<0)throw new Error(`There is no ${l} event in ${o} controller !!!`);e.htmlDeclaredSubscriptions[`${o}_${l}_${i.name.toLowerCase()}`]={listener:i,methodName:s}}))})),window.plugsters=e.registry))}setLocales(e){this.locales=e}translateTo(e,t){return this.locales[e]&&this.locales[e][t]?this.locales[e][t]:t}toString(){return this.name}init(){let e=this;console.log(`Initializing ${e.name} Controller.`);let t=e.bindOutlets();return new window.Promise(((i,n)=>window.Promise.all(t).then((function(){console.log(`${e.name} Controller Initialized`),e.afterInit(),i(e)})).catch((e=>{n(e)}))))}afterInit(){throw new Error("Every Plugster must implement its own afterInit method !!!")}bindOutlets(){let e=this;console.log(`Binding Outlets for ${e.name} Controller.`);let t=[],i=`[data-controller-name=${e.name}]`;if(0===$(i).length)throw new Error(`There is no view with a ${e.name} controller !!!`);let n=$(i);return $.map(e._,(function(i,r){let s=`[data-outlet-id='${r}']`;if(0===n.find(s).length)throw new Error(`Outlet ${r} does not exist, check both ${e.name} view and controller !!!`);let o=n.find(s);if(o.length>1){o=$.map(o,(function(t){return $(t).closest("[data-controller-name]").data("controller-name")===e.name?$(t):null}))[0]}if(o.attr("id",`${e.name}_${r}`),o.data("child-templates")){o.buildListItem=function(t,i,n,s,o){this.items||(this.items={}),this.items[i]||(this.items[i]={}),this.append(e.childTemplates[`${r}_${t}`]);let l=e.compileChildTemplate(r,this.children().length-1,this.children().last(),s);return null===l?null:(l.root.attr("data-key",i),o&&l.root.click((function(){o(i,n)})),this.items[i].outlets=l,this.items[i].data=n,this.items[i].outlets)},o.count=function(){return this.items?Object.keys(this.items).length:0},o.getData=function(e){return this.items[e].data},o.getOutlets=function(e){return this.items[e].outlets},o.delete=function(e){this.children(`[data-key='${e}']`).remove(),delete this.items[e]},o.clear=function(){this.items=void 0,this.children().remove()};let i=o.data("child-templates");$.map(i,(function(i,n){let s=$.Deferred();t.push(s.promise()),e.loadChildTemplate(r,n,i,s)}))}e._[r]=o})),e._.root=n,console.log(`Outlets for ${e.name} Controller were binded successfuly !!!`),t}loadChildTemplate(e,t,i,n){let r=this;$.get({url:i,cache:!1},(function(s){r.childTemplates[`${e}_${t}`]=s,console.log(`Template ${i} loaded.`),n.resolve()}))}compileChildTemplate(e,t,i,n){if(!n||0===Object.keys(n).length)return null;let r={};return r.root=i,$.map(i.find("[data-child-outlet-id]"),(function(i){$(i).attr("id",`${e}_${$(i).data("child-outlet-id")}_${t}`),r[$(i).data("child-outlet-id")]=$(i)})),r}registerEventSignature(e,t,i){if(!e)return;if(!t)return;if(!i)return;let n=this.cloneDeep(t);$(this).on(e,n,i)}dispatchEvent(e,t){let i=this.cloneDeep(t);this.broadcastExplicitSubscriptionsMessages(e,i),this.broadcastHtmlDeclaredSubscriptionsMessages(e,i),$(this).triggerHandler(new $.Event(e,{args:i}))}cloneDeep(e,t=new WeakMap){let i=this;const n=Object.prototype.toString.call(e);if(!new RegExp(["Array","Object","Map","Set","WeakMap","WeakSet"].join("|")).test(n))return e;if(t.has(e))return t.get(e);const r=new e.constructor;return(e instanceof Map||e instanceof WeakMap)&&e.forEach(((e,t)=>r.set(i.cloneDeep(t),i.cloneDeep(e)))),(e instanceof Set||e instanceof WeakSet)&&e.forEach((e=>r.add(i.cloneDeep(e)))),t.set(e,r),Object.assign(r,...Object.keys(e).map((n=>({[n]:i.cloneDeep(e[n],t)}))))}broadcastExplicitSubscriptionsMessages(t,i){let n=this,r=`${this.name}_${t}`.toLowerCase();Object.keys(e.explicitSubscriptions).map((function(s){if(s.startsWith(r)){if(!e.explicitSubscriptions[s].onNewMessage)throw new Error("Subscriber must implement onNewMessage method.");e.explicitSubscriptions[s].onNewMessage(n.name,t,i)}}))}broadcastHtmlDeclaredSubscriptionsMessages(t,i){let n=`${this.name}_${t}`.toLowerCase();Object.keys(e.htmlDeclaredSubscriptions).map((function(t){if(t.startsWith(n)){let n=e.htmlDeclaredSubscriptions[t];n.listener[n.methodName].call(n.listener,i)}}))}listenTo(t,i){e.explicitSubscriptions[`${t.name}_${i.name}_${this.name}`.toLowerCase()]=this}static createView(e,t,i){$.get({url:t,cache:!1},(function(t){i(t.replace("[CONTROLLER_NAME]",e))}))}}export{e as Plugster};
//# sourceMappingURL=plugster.min.js.map
