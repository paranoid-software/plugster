export default class t{constructor(e,i){t.document=$(document);this.dictionary={};this.name=i||this.constructor.name;console.log(`${this.name} Controller Instantiated.`);if(!t.registry){t.registry={};$("[data-controller-name]").map((function(e,i){t.registry[$(i).data("controllerName").toLowerCase()]=undefined}))}t.registry[this.name.toLowerCase()]=this;if(!t.explicitSubscriptions)t.explicitSubscriptions={};if(!t.htmlDeclaredSubscriptions)t.htmlDeclaredSubscriptions={};this._=e;this.childTemplates={};this.init();let r=true;Object.keys(t.registry).map((function(e){if(!t.registry[e])r=false}));if(r&&!window.plugsters){Object.keys(t.registry).map((function(e){let i=t.registry[e];let r=t.registry[e]._.root;Object.keys(r.data()).map((function(e){let n=e.replace(/[A-Z]/g,(t=>"-"+t.toLowerCase()));let s=n.split("-");if(s.length!==3)return null;if(s[0]!=="on")return null;let l=r.data(e);if(!i[l])throw new Error(`There is no method ${l} within the ${i.name} controller !!!`);let o=s[1];let a=s[2];if(!t.registry[o])throw new Error(`There is no ${o} controller !!!`);let c=Object.getOwnPropertyNames(Object.getPrototypeOf(t.registry[o])).map((t=>t.toLowerCase()));if(c.indexOf(a)<0)throw new Error(`There is no ${a} event in ${o} controller !!!`);t.htmlDeclaredSubscriptions[`${o}_${a}_${i.name.toLowerCase()}`]={listener:i,methodName:l}}))}));window.plugsters=t.registry}}setDictionary(t){this.dictionary=t}translateTo(t,e){if(!this.dictionary[t])return e;if(!this.dictionary[t][e])return e;return this.dictionary[t][e]}toString(){return this.name}init(){let t=this;console.log(`Initializing ${t.name} Controller.`);t.bindOutlets((function(){console.log(`${t.name} Controller Initialized`);t.afterInit()}))}afterInit(){throw new Error("You have to implement the Plugster afterInit method !!!")}bindOutlets(t){let e=this;console.log(`Binding Outlets for ${e.name} Controller.`);let i=[];let r=`[data-controller-name=${e.name}]`;if($(r).length===0)throw new Error(`There is no view with a ${e.name} controller !!!`);let n=$(r);$.map(e._,(function(t,r){let s=`[data-outlet-id='${r}']`;if(n.find(s).length===0)throw new Error(`Outlet ${r} does not exist, check both ${e.name} view and controller !!!`);let l=n.find(s);if(l.length>1){let t=$.map(l,(function(t){if($(t).closest("[data-controller-name]").data("controller-name")===e.name)return $(t);return null}));l=t[0]}l.attr("id",`${e.name}_${r}`);if(l.data("child-templates")){l.buildListItem=function(t,i,n,s,l){if(!this.items)this.items={};if(!this.items[i])this.items[i]={};this.append(e.childTemplates[`${r}_${t}`]);let o=e.compileChildTemplate(r,this.children().length-1,this.children().last(),s);if(o===null)return null;o.root.attr("data-key",i);if(l)o.root.click((function(){l(i,n)}));this.items[i].outlets=o;this.items[i].data=n;return this.items[i].outlets};l.count=function(){if(!this.items)return 0;return Object.keys(this.items).length};l.getData=function(t){return this.items[t].data};l.getOutlets=function(t){return this.items[t].outlets};l.delete=function(t){this.children(`[data-key='${t}']`).remove();delete this.items[t]};l.clear=function(){this.items=undefined;this.children().remove()};let t=l.data("child-templates");$.map(t,(function(t,n){let s=$.Deferred();i.push(s.promise());e.loadChildTemplate(r,n,t,s)}))}e._[r]=l}));e._.root=n;console.log(`Outlets for ${e.name} Controller were binded successfuly !!!`);window.Promise.all(i).then((function(){t()}))}loadChildTemplate(t,e,i,r){let n=this;$.get({url:i,cache:false},(function(s){n.childTemplates[`${t}_${e}`]=s;console.log(`Template ${i} loaded.`);r.resolve()}))}compileChildTemplate(t,e,i,r){if(!r||Object.keys(r).length===0)return null;let n={};n.root=i;$.map(i.find("[data-child-outlet-id]"),(function(i){$(i).attr("id",`${t}_${$(i).data("child-outlet-id")}_${e}`);n[$(i).data("child-outlet-id")]=$(i)}));return n}registerEventSignature(t,e,i){let r=_.cloneDeep(e);$(this).on(t,r,i)}dispatchEvent(t,e){let i=_.cloneDeep(e);this.broadcastExplicitSubscriptionsMessages(t,i);this.broadcastHtmlDeclaredSubscriptionsMessages(t,i);$(this).trigger(new $.Event(t,{args:i}))}broadcastExplicitSubscriptionsMessages(e,i){let r=this;let n=`${this.name}_${e}`.toLowerCase();Object.keys(t.explicitSubscriptions).map((function(s){if(s.startsWith(n)){t.explicitSubscriptions[s]?.onNewMessage(r.name,e,i)}}))}broadcastHtmlDeclaredSubscriptionsMessages(e,i){let r=`${this.name}_${e}`.toLowerCase();Object.keys(t.htmlDeclaredSubscriptions).map((function(e){if(e.startsWith(r)){let r=t.htmlDeclaredSubscriptions[e];r.listener[r.methodName].call(r.listener,i)}}))}listenTo(e,i){t.explicitSubscriptions[`${e.name}_${i.name}_${this.name}`.toLowerCase()]=this}static createView(t,e,i){$.get({url:e,cache:false},(function(e){i(e.replace("[CONTROLLER_NAME]",t))}))}}
//# sourceMappingURL=plugster.min.js.map