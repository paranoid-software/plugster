export default class t{constructor(e){this.name=this.constructor.name;console.log(`${this.name} Controller Instantiated.`);this._=e;this.childTemplates={};this.init();if(!t.registry)t.registry={};t.registry[this.name.toLowerCase()]=this;if(!t.explicitSubscriptions)t.explicitSubscriptions={};if(!t.htmlDeclaredSubscriptions)t.htmlDeclaredSubscriptions={}}toString(){return this.name}init(){let t=this;console.log(`Initializing ${t.name} Controller.`);t.bindOutlets((function(){console.log(`${t.name} Controller Initialized`);t.afterInit()}))}afterInit(){throw new Error("You have to implement the Plugster afterInit method !!!")}bindOutlets(e){let i=this;console.log(`Binding Outlets for ${i.name} Controller.`);let n=[];let s=`[data-controller-name=${i.name}]`;if($(s).length===0)throw new Error(`There is no view with a ${i.name} controller !!!`);let r=$(s);$.map(i._,(function(t,e){let s=`[data-outlet-id='${e}']`;if(r.find(s).length===0)throw new Error(`Outlet ${e} does not exist, check both ${i.name} view and controller !!!`);let l=r.find(s);if(l.length>1){let t=$.map(l,(function(t){if($(t).closest("[data-controller-name]").data("controller-name")===i.name)return $(t);return null}));l=t[0]}if(l.data("child-templates")){l.buildListItem=function(t,n,s,r,l){if(!this.items)this.items={};if(!this.items[n])this.items[n]={};this.append(i.childTemplates[`${e}_${t}`]);let o=i.compileChildTemplate(this.children().last(),r);if(o===null)return null;o.root.attr("data-key",n);if(l)o.root.click((function(){l(n,s)}));this.items[n].outlets=o;this.items[n].data=s;return this.items[n].outlets};l.count=function(){return Object.keys(this.items).length};l.getData=function(t){return this.items[t].data};l.getOutlets=function(t){return this.items[t].outlets};l.clear=function(){this.items=undefined;this.children().remove()};let t=l.data("child-templates");$.map(t,(function(t,s){let r=$.Deferred();n.push(r.promise());i.loadChildTemplate(e,s,t,r)}))}i._[e]=l}));i._.root=r;Object.keys(r.data()).map((function(e){let n=e.replace(/[A-Z]/g,(t=>"-"+t.toLowerCase()));let s=n.split("-");if(s.length!==3)return null;if(s[0]!=="on")return null;let l=r.data(e);if(!i[l])throw new Error(`There is no method ${l} within the ${i.name} controller !!!`);let o=s[1];let a=s[2];if(!t.registry[o])throw new Error(`There is no ${o} controller !!!`);let c=Object.getOwnPropertyNames(Object.getPrototypeOf(t.registry[o])).map((t=>t.toLowerCase()));if(c.indexOf(a)<0)throw new Error(`There is no ${a} event in ${o} controller !!!`);t.htmlDeclaredSubscriptions[`${o}_${a}_${i.name.toLowerCase()}`]={listener:i,methodName:l}}));console.log(`Outlets for ${i.name} Controller were binded successfuly !!!`);window.Promise.all(n).then((function(){e()}))}loadChildTemplate(t,e,i,n){let s=this;$.get({url:i,cache:false},(function(r){s.childTemplates[`${t}_${e}`]=r;console.log(`Template ${i} loaded.`);n.resolve()}))}compileChildTemplate(t,e){if(!e||Object.keys(e).length===0)return null;let i={};i.root=t;$.map(t.find("[data-child-outlet-id]"),(function(t){i[$(t).data("child-outlet-id")]=$(t)}));return i}registerEventSignature(t,e,i){$(this).on(t,e,i)}dispatchEvent(t,e){this.broadcastExplicitSubscriptionsMessages(t,e);this.broadcastHtmlDeclaredSubscriptionsMessages(t,e);$(this).trigger(new $.Event(t,{args:e}))}broadcastExplicitSubscriptionsMessages(e,i){let n=this.name.toLowerCase();let s=`${this.name}_${e}`.toLowerCase();t.explicitSubscriptions[n]?.onNewMessage(this.name,e,i);t.explicitSubscriptions[s]?.onNewMessage(this.name,e,i)}broadcastHtmlDeclaredSubscriptionsMessages(e,i){let n=`${this.name}_${e}`.toLowerCase();Object.keys(t.htmlDeclaredSubscriptions).map((function(e){if(e.startsWith(n)){let n=t.htmlDeclaredSubscriptions[e];n.listener[n.methodName].call(n.listener,i)}}))}listenTo(e,i){if(!i){t.explicitSubscriptions[e.name.toLowerCase()]=this;return}t.explicitSubscriptions[`${e.name}_${i.name}`.toLowerCase()]=this}}
//# sourceMappingURL=plugster.min.js.map